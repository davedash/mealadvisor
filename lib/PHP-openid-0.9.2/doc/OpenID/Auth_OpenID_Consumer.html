<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos -->
			<title>Docs For Class Auth_OpenID_Consumer</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
			<meta http-equiv='Content-Type' content='text/html; charset=iso-8859-1'/>
		</head>
		<body>
			<div class="page-body">			
<h2 class="class-name">Class Auth_OpenID_Consumer</h2>

<a name="sec-description"></a>
<div class="info-box">
	<div class="info-box-title">Description</div>
	<div class="nav-bar">
					<span class="disabled">Description</span> |
													<a href="#sec-var-summary">Vars</a> (<a href="#sec-vars">details</a>)
						|											<a href="#sec-method-summary">Methods</a> (<a href="#sec-methods">details</a>)
						
			</div>
	<div class="info-box-body">
		<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This class is the interface to the OpenID consumer logic.</p>
<p class="description"><p>Instances of it maintain no per-request state, so they can be  reused (or even used by multiple threads concurrently) as needed.</p></p>
		<p class="notes">
			Located in <a class="field" href="_OpenID_Consumer_php.html">/OpenID/Consumer.php</a> (line <span class="field">248</span>)
		</p>
		
		        
		<pre></pre>
	
			</div>
</div>


	<a name="sec-var-summary"></a>
	<div class="info-box">
		<div class="info-box-title">Variable Summary</span></div>
		<div class="nav-bar">
			<a href="#sec-description">Description</a> |
						<span class="disabled">Vars</span> (<a href="#sec-vars">details</a>)
							| 
									<a href="#sec-method-summary">Methods</a> (<a href="#sec-methods">details</a>)
							
					</div>
		<div class="info-box-body">
			<div class="var-summary">
								<div class="var-title">
					<span class="var-type">mixed</span>
					<a href="#$fetcher" title="details" class="var-name">$fetcher</a>
				</div>
								<div class="var-title">
					<span class="var-type">mixed</span>
					<a href="#$mode" title="details" class="var-name">$mode</a>
				</div>
								<div class="var-title">
					<span class="var-type">mixed</span>
					<a href="#$nonce_chrs" title="details" class="var-name">$nonce_chrs</a>
				</div>
								<div class="var-title">
					<span class="var-type">mixed</span>
					<a href="#$store" title="details" class="var-name">$store</a>
				</div>
								<div class="var-title">
					<span class="var-type">mixed</span>
					<a href="#$token_lifetime" title="details" class="var-name">$token_lifetime</a>
				</div>
							</div>
		</div>
	</div>

	<a name="sec-method-summary"></a>
	<div class="info-box">
		<div class="info-box-title">Method Summary</span></div>
		<div class="nav-bar">
			<a href="#sec-description">Description</a> |
															<a href="#sec-var-summary">Vars</a> (<a href="#sec-vars">details</a>)
				 
				|
						<span class="disabled">Methods</span> (<a href="#sec-methods">details</a>)
		</div>
		<div class="info-box-body">			
			<div class="method-summary">
								
				<div class="method-definition">
											<span class="method-result">Auth_OpenID_Consumer</span>
										<a href="#Auth_OpenID_Consumer" title="details" class="method-name">Auth_OpenID_Consumer</a>
											(<span class="var-type"><a href="../OpenID/Auth_OpenID_OpenIDStore.html">Auth_OpenID_OpenIDStore</a></span>&nbsp;<span class="var-name">&$store</span>, [<span class="var-type">Auth_OpenID_HTTPFetcher</span>&nbsp;<span class="var-name">$fetcher</span> = <span class="var-default">null</span>], <span class="var-type">bool</span>&nbsp;<span class="var-name">$immediate</span>)
									</div>
								
				<div class="method-definition">
											<span class="method-result">array</span>
										<a href="#beginAuth" title="details" class="method-name">beginAuth</a>
											(<span class="var-type">string</span>&nbsp;<span class="var-name">$user_url</span>)
									</div>
								
				<div class="method-definition">
											<span class="method-result">array</span>
										<a href="#completeAuth" title="details" class="method-name">completeAuth</a>
											(<span class="var-type">string</span>&nbsp;<span class="var-name">$token</span>, <span class="var-type">array</span>&nbsp;<span class="var-name">$query</span>)
									</div>
								
				<div class="method-definition">
											<span class="method-result">string</span>
										<a href="#constructRedirect" title="details" class="method-name">constructRedirect</a>
											(<span class="var-type"><a href="../OpenID/Auth_OpenID_AuthenticationRequest.html">Auth_OpenID_AuthenticationRequest</a></span>&nbsp;<span class="var-name">$auth_request</span>, <span class="var-type">string</span>&nbsp;<span class="var-name">$return_to</span>, <span class="var-type">string</span>&nbsp;<span class="var-name">$trust_root</span>, [<span class="var-type">mixed</span>&nbsp;<span class="var-name">$immediate</span> = <span class="var-default">false</span>])
									</div>
								
				<div class="method-definition">
											<span class="method-result">void</span>
										<a href="#_createDiffieHellman" title="details" class="method-name">_createDiffieHellman</a>
										()
									</div>
							</div>
		</div>
	</div>		

	<a name="sec-vars"></a>
	<div class="info-box">
		<div class="info-box-title">Variables</div>
		<div class="nav-bar">
			<a href="#sec-description">Description</a> |
										<a href="#sec-var-summary">Vars</a> (<span class="disabled">details</span>)
						
			
							| 
									<a href="#sec-method-summary">Methods</a> (<a href="#sec-methods">details</a>)
							
					</div>
		<div class="info-box-body">
			<a name="var$fetcher" id="$fetcher"><!-- --></A>
<div class="evenrow">

	<div class="var-header">
		<span class="var-title">
			<span class="var-type">mixed</span>
			<span class="var-name">$fetcher</span>
						(line <span class="line-number">262</span>)
		</span>
	</div>

	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This consumer's HTTP fetcher object.</p>
	
	
		
		

</div>
<a name="var$mode" id="$mode"><!-- --></A>
<div class="oddrow">

	<div class="var-header">
		<span class="var-title">
			<span class="var-type">mixed</span>
			<span class="var-name">$mode</span>
						(line <span class="line-number">267</span>)
		</span>
	</div>

	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">The consumer's mode.</p>
	
	
		
		

</div>
<a name="var$nonce_chrs" id="$nonce_chrs"><!-- --></A>
<div class="evenrow">

	<div class="var-header">
		<span class="var-title">
			<span class="var-type">mixed</span>
			<span class="var-name">$nonce_chrs</span>
			 = <span class="var-default"> Auth_OpenID_DEFAULT_NONCE_CHRS</span>			(line <span class="line-number">272</span>)
		</span>
	</div>

	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">What characters are allowed in nonces</p>
	
	
		
		

</div>
<a name="var$store" id="$store"><!-- --></A>
<div class="oddrow">

	<div class="var-header">
		<span class="var-title">
			<span class="var-type">mixed</span>
			<span class="var-name">$store</span>
						(line <span class="line-number">252</span>)
		</span>
	</div>

	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This consumer's store object.</p>
	
	
		
		

</div>
<a name="var$token_lifetime" id="$token_lifetime"><!-- --></A>
<div class="evenrow">

	<div class="var-header">
		<span class="var-title">
			<span class="var-type">mixed</span>
			<span class="var-name">$token_lifetime</span>
			 = <span class="var-default"> Auth_OpenID_DEFAULT_TOKEN_LIFETIME</span>			(line <span class="line-number">281</span>)
		</span>
	</div>

	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">How long should an authentication session stay good?</p>
<p class="description"><p>In units of sections. Shorter times mean less opportunity for  attackers, longer times mean less chance of a user's session  timing out.</p></p>
	
	
		
		

</div>
						
		</div>
	</div>
	
	<a name="sec-methods"></a>
	<div class="info-box">
		<div class="info-box-title">Methods</div>
		<div class="nav-bar">
			<a href="#sec-description">Description</a> |
															<a href="#sec-var-summary">Vars</a> (<a href="#sec-vars">details</a>)
														<a href="#sec-method-summary">Methods</a> (<span class="disabled">details</span>)
						
		</div>
		<div class="info-box-body">
			<A NAME='method_detail'></A>
<a name="methodAuth_OpenID_Consumer" id="Auth_OpenID_Consumer"><!-- --></a>
<div class="oddrow">
	
	<div class="method-header">
		<span class="method-title">Constructor Auth_OpenID_Consumer</span> (line <span class="line-number">312</span>)
	</div> 
	
	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This method initializes a new Auth_OpenID_Consumer instance to  access the library.</p>
	
	<div class="method-signature">
		<span class="method-result">Auth_OpenID_Consumer</span>
		<span class="method-name">
			Auth_OpenID_Consumer
		</span>
					(<span class="var-type"><a href="../OpenID/Auth_OpenID_OpenIDStore.html">Auth_OpenID_OpenIDStore</a></span>&nbsp;<span class="var-name">&$store</span>, [<span class="var-type">Auth_OpenID_HTTPFetcher</span>&nbsp;<span class="var-name">$fetcher</span> = <span class="var-default">null</span>], <span class="var-type">bool</span>&nbsp;<span class="var-name">$immediate</span>)
			</div>
	
			<ul class="parameters">
					<li>
				<span class="var-type"><a href="../OpenID/Auth_OpenID_OpenIDStore.html">Auth_OpenID_OpenIDStore</a></span>
				<span class="var-name">$store</span><span class="var-description">: This must be an object  that implements the interface in Auth_OpenID_Store.  Several  concrete implementations are provided, to cover most common use  cases.  For stores backed by MySQL, PostgreSQL, or SQLite, see  the Auth_OpenID_SQLStore class and its sublcasses.  For a  filesystem-backed store, see the Auth_OpenID_FileStore module.  As a last resort, if it isn't possible for the server to store  state at all, an instance of Auth_OpenID_DumbStore can be used.  This should be an absolute last resort, though, as it makes the  consumer vulnerable to replay attacks over the lifespan of the  tokens the library creates.</span>			</li>
					<li>
				<span class="var-type">Auth_OpenID_HTTPFetcher</span>
				<span class="var-name">$fetcher</span><span class="var-description">: This is an optional  reference to an instance of Auth_OpenID_HTTPFetcher.  If  present, the provided fetcher is used by the library to fetch  users' identity pages and make direct requests to the identity  server.  If it is not present, a default fetcher is used.  The  default fetcher uses curl if the Curl bindings are available,  and uses a raw socket POST if not.</span>			</li>
					<li>
				<span class="var-type">bool</span>
				<span class="var-name">$immediate</span><span class="var-description">: This is an optional boolean value.  It  controls whether the library uses immediate mode, as explained  in the module description.  The default value is False, which  disables immediate mode.</span>			</li>
				</ul>
		
		
	</div>
<a name="methodbeginAuth" id="beginAuth"><!-- --></a>
<div class="evenrow">
	
	<div class="method-header">
		<span class="method-title">beginAuth</span> (line <span class="line-number">390</span>)
	</div> 
	
	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This method is called to start the OpenID login process.</p>
<p class="description"><p>First, the user's claimed identity page is fetched, to  determine their identity server.  If the page cannot be fetched  or if the page does not have the necessary link tags in it,  this method returns one of Auth_OpenID_HTTP_FAILURE or  Auth_OpenID_PARSE_ERROR, depending on where the process failed.</p><p>Second, unless the store provided is a dumb store, it checks to  see if it has an association with that identity server, and  creates and stores one if not.</p><p>Third, it generates a signed token for this authentication  transaction, which contains a timestamp, a nonce, and the  information needed in Step 4 (above) in the module overview.  The token is used by the library to make handling the various  pieces of information needed in Step 4 (above) easy and secure.</p><p>The token generated must be preserved until Step 4 (above),  which is after the redirect to the OpenID server takes place.  This means that the token must be preserved across http  requests.  There are three basic approaches that might be used  for storing the token.  First, the token could be put in the  return_to URL passed into the constructRedirect method.  Second, the token could be stored in a cookie.  Third, in an  environment that supports user sessions, the session is a good  spot to store the token.</p></p>
	<ul class="tags">
				<li><span class="field">return:</span> <p>This method returns an array containing a  status code and additional information about the code.</p><p>If there was a problem fetching the identity page the user  gave, the status code is set to Auth_OpenID_HTTP_FAILURE, and  the additional information value is either set to null if the  HTTP transaction failed or the HTTP return code, which will be  in the 400-500 range. This additional information value may  change in a future release.</p><p>If the identity page fetched successfully, but didn't include  the correct link tags, the status code is set to  Auth_OpenID_PARSE_ERROR, and the additional information value  is currently set to null.  The additional information value may  change in a future release.</p><p>Otherwise, the status code is set to Auth_OpenID_SUCCESS, and  the additional information is an instance of  Auth_OpenID_AuthenticationRequest.  The $token attribute  contains the token to be preserved for the next HTTP request.  The $server_url might also be of interest, if you wish to  blacklist or whitelist OpenID servers.  The other contents of  the object are information needed in the constructRedirect  call.</p></li>
			</ul>
	
	<div class="method-signature">
		<span class="method-result">array</span>
		<span class="method-name">
			beginAuth
		</span>
					(<span class="var-type">string</span>&nbsp;<span class="var-name">$user_url</span>)
			</div>
	
			<ul class="parameters">
					<li>
				<span class="var-type">string</span>
				<span class="var-name">$user_url</span><span class="var-description">: This is the url the user entered as  their OpenID.  This call takes care of normalizing it and  resolving any redirects the server might issue.</span>			</li>
				</ul>
		
		
	</div>
<a name="methodcompleteAuth" id="completeAuth"><!-- --></a>
<div class="oddrow">
	
	<div class="method-header">
		<span class="method-title">completeAuth</span> (line <span class="line-number">508</span>)
	</div> 
	
	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This method is called to interpret the server's response to an  OpenID request.  It is called in Step 4 of the flow described  in the overview.</p>
<p class="description"><p>The return value is a pair, consisting of a status and  additional information.  The status values are strings, but  should be referred to by their symbolic values:  Auth_OpenID_SUCCESS, Auth_OpenID_FAILURE, and  Auth_OpenID_SETUP_NEEDED.</p><p>When Auth_OpenID_SUCCESS is returned, the additional  information returned is either null or a string.  If it is  null, it means the user cancelled the login, and no further  information can be determined.  If the additional information  is a string, it is the identity that has been verified as  belonging to the user making this request.</p><p>When Auth_OpenID_FAILURE is returned, the additional  information is either null or a string.  In either case, this  code means that the identity verification failed.  If it can be  determined, the identity that failed to verify is returned.  Otherwise null is returned.</p><p>When Auth_OpenID_SETUP_NEEDED is returned, the additional  information is the user setup URL.  This is a URL returned only  as a response to requests made with openid.mode=immediate,  which indicates that the login was unable to proceed, and the  user should be sent to that URL if they wish to proceed with  the login.</p></p>
	<ul class="tags">
				<li><span class="field">return:</span> Returns the status of the response and any  additional information, as described above.</li>
			</ul>
	
	<div class="method-signature">
		<span class="method-result">array</span>
		<span class="method-name">
			completeAuth
		</span>
					(<span class="var-type">string</span>&nbsp;<span class="var-name">$token</span>, <span class="var-type">array</span>&nbsp;<span class="var-name">$query</span>)
			</div>
	
			<ul class="parameters">
					<li>
				<span class="var-type">string</span>
				<span class="var-name">$token</span><span class="var-description">: This is the token for this authentication  transaction, generated by the call to beginAuth.</span>			</li>
					<li>
				<span class="var-type">array</span>
				<span class="var-name">$query</span><span class="var-description">: This is a dictionary-like object containing  the query parameters the OpenID server included in its redirect  back to the return_to URL.  The keys and values should both be  url-unescaped.</span>			</li>
				</ul>
		
		
	</div>
<a name="methodconstructRedirect" id="constructRedirect"><!-- --></a>
<div class="evenrow">
	
	<div class="method-header">
		<span class="method-title">constructRedirect</span> (line <span class="line-number">438</span>)
	</div> 
	
	<!-- ========== Info from phpDoc block ========= -->
<p class="short-description">This method is called to construct the redirect URL sent to the  browser to ask the server to verify its identity.  This is  called in Step 3 (above) of the flow described in the overview.</p>
<p class="description"><p>The generated redirect should be sent to the browser which  initiated the authorization request.</p></p>
	<ul class="tags">
				<li><span class="field">return:</span> This method returns a string containing the  URL to redirect to when such a URL is successfully constructed.</li>
			</ul>
	
	<div class="method-signature">
		<span class="method-result">string</span>
		<span class="method-name">
			constructRedirect
		</span>
					(<span class="var-type"><a href="../OpenID/Auth_OpenID_AuthenticationRequest.html">Auth_OpenID_AuthenticationRequest</a></span>&nbsp;<span class="var-name">$auth_request</span>, <span class="var-type">string</span>&nbsp;<span class="var-name">$return_to</span>, <span class="var-type">string</span>&nbsp;<span class="var-name">$trust_root</span>, [<span class="var-type">mixed</span>&nbsp;<span class="var-name">$immediate</span> = <span class="var-default">false</span>])
			</div>
	
			<ul class="parameters">
					<li>
				<span class="var-type"><a href="../OpenID/Auth_OpenID_AuthenticationRequest.html">Auth_OpenID_AuthenticationRequest</a></span>
				<span class="var-name">$auth_request</span><span class="var-description">: This  must be a Auth_OpenID_AuthenticationRequest instance which was  returned from a previous call to beginAuth.  It contains  information found during the beginAuth call which is needed to  build the redirect URL.</span>			</li>
					<li>
				<span class="var-type">string</span>
				<span class="var-name">$return_to</span><span class="var-description">: This is the URL that will be included  in the generated redirect as the URL the OpenID server will  send its response to.  The URL passed in must handle OpenID  authentication responses.</span>			</li>
					<li>
				<span class="var-type">string</span>
				<span class="var-name">$trust_root</span><span class="var-description">: This is a URL that will be sent to  the server to identify this site.  The OpenID spec at  http://www.openid.net/specs.bml#mode-checkid_immediate has more  information on what the trust_root value is for and what its  form can be.  While the trust root is officially optional in  the OpenID specification, this implementation requires that it  be set.  Nothing is actually gained by leaving out the trust  root, as you can get identical behavior by specifying the  return_to URL as the trust root.</span>			</li>
				</ul>
		
		
	</div>
<a name="method_createDiffieHellman" id="_createDiffieHellman"><!-- --></a>
<div class="oddrow">
	
	<div class="method-header">
		<span class="method-title">_createDiffieHellman</span> (line <span class="line-number">665</span>)
	</div> 
	
	<!-- ========== Info from phpDoc block ========= -->
	<ul class="tags">
				<li><span class="field">access:</span> protected</li>
			</ul>
	
	<div class="method-signature">
		<span class="method-result">void</span>
		<span class="method-name">
			_createDiffieHellman
		</span>
				()
			</div>
	
		
		
	</div>
						
		</div>
	</div>
	
	<p class="notes" id="credit">
		Documentation generated on Wed, 22 Feb 2006 17:56:49 -0800 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.2.3</a>
	</p>
	</div></body>
</html>